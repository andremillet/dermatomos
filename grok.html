<!DOCTYPE html> 
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Diferencial: Nervo Periférico vs. Raiz Nervosa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        select, button {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            max-width: 300px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #sugestoes {
            margin-top: 20px;
        }
        .sugestao {
            background: #e9ecef;
        padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .categoria {
            font-weight: bold;
            color: #007bff;
        }
        .regiao-item {
            margin: 5px 0;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        input[type="checkbox"] {
            margin-right: 10px;
        }
        #diagnostico {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            font-size: 16px;
        }
        .periferico { background-color: #d4edda; color: #155724; }
        .raiz { background-color: #f8d7da; color: #721c24; }
        .indeterminado { background-color: #fff3cd; color: #856404; }
        .suspeita { background-color: #fffacd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Diagnóstico Diferencial: Lesão em Nervo Periférico vs. Raiz Nervosa</h1>
        <p>Selecione uma região da pele afetada e o tipo de alteração sensitiva para iniciar o diagnóstico diferencial.</p>

        <label for="regiaoSelect">Região da Pele Afetada:</label>
        <select id="regiaoSelect">
            <option value="">Selecione uma região...</option>
        </select>

        <label for="sintomaSelect">Alteração Sensitiva:</label>
        <select id="sintomaSelect">
            <option value="">Selecione o sintoma...</option>
            <option value="dor">Dor</option>
            <option value="vibracao">Vibração</option>
            <option value="ambas">Ambas</option>
        </select>

        <button onclick="iniciarAnalise()">Analisar e Sugerir Testes</button>

        <div id="sugestoes"></div>

        <div id="diagnostico"></div>
    </div>

    <script>
        // Dados hardcoded para simplicidade
        const dados = {
            "regioes_sensitivas": [
                {
                    "regiao": "Pele da região lateral do antebraço (nervo cutâneo lateral do antebraço)",
                    "nervo_periferico": "Nervo musculocutâneo",
                    "raizes_nervosas": ["C5", "C6", "C7"]
                },
                {
                    "regiao": "Pele sobre o músculo deltoide",
                    "nervo_periferico": "Nervo axilar",
                    "raizes_nervosas": ["C5", "C6"]
                },
                {
                    "regiao": "Pele da superfície posterior do braço",
                    "nervo_periferico": "Nervo radial",
                    "raizes_nervosas": ["C5", "C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Região central da superfície posterior do antebraço",
                    "nervo_periferico": "Nervo radial",
                    "raizes_nervosas": ["C5", "C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Superfície lateral do dorso da mão",
                    "nervo_periferico": "Nervo radial",
                    "raizes_nervosas": ["C5", "C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Região posterior do polegar, do indicador e da metade lateral do dedo médio",
                    "nervo_periferico": "Nervo radial",
                    "raizes_nervosas": ["C5", "C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Pele da metade lateral da palma da mão",
                    "nervo_periferico": "Nervo mediano",
                    "raizes_nervosas": ["C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Porção anterior do polegar, do indicador, do dedo médio e da metade lateral do anelar",
                    "nervo_periferico": "Nervo mediano",
                    "raizes_nervosas": ["C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Porção posterior do polegar, do indicador e da metade lateral do dedo médio",
                    "nervo_periferico": "Nervo mediano",
                    "raizes_nervosas": ["C6", "C7", "C8", "T1"]
                },
                {
                    "regiao": "Pele anterior e posterior da metade medial da palma da mão",
                    "nervo_periferico": "Nervo ulnar",
                    "raizes_nervosas": ["C8", "T1"]
                },
                {
                    "regiao": "Pele anterior e posterior do dedo mínimo e da metade medial do anelar",
                    "nervo_periferico": "Nervo ulnar",
                    "raizes_nervosas": ["C8", "T1"]
                }
            ]
        };

        // Inicializar dropdown de regiões
        function inicializarDropdowns() {
            const regiaoSelect = document.getElementById('regiaoSelect');
            dados.regioes_sensitivas.forEach(item => {
                const option = document.createElement('option');
                option.value = item.regiao;
                option.textContent = item.regiao;
                regiaoSelect.appendChild(option);
            });
        }

        // Mapas para agrupar regiões por nervo e por raiz
        let mapaNervoRegioes = {};
        let mapaRaizRegioes = {};

        function criarMapas() {
            dados.regioes_sensitivas.forEach(item => {
                // Por nervo
                if (!mapaNervoRegioes[item.nervo_periferico]) {
                    mapaNervoRegioes[item.nervo_periferico] = [];
                }
                mapaNervoRegioes[item.nervo_periferico].push(item.regiao);

                // Por raiz (cada raiz separada)
                item.raizes_nervosas.forEach(raiz => {
                    if (!mapaRaizRegioes[raiz]) {
                        mapaRaizRegioes[raiz] = [];
                    }
                    if (!mapaRaizRegioes[raiz].includes(item.regiao)) {
                        mapaRaizRegioes[raiz].push(item.regiao);
                    }
                });
            });
        }

        function iniciarAnalise() {
            const regiaoSelecionada = document.getElementById('regiaoSelect').value;
            const sintoma = document.getElementById('sintomaSelect').value;

            if (!regiaoSelecionada || !sintoma) {
                alert('Selecione uma região e um sintoma antes de analisar.');
                return;
            }

            // Encontrar dados da região selecionada
            const itemSelecionado = dados.regioes_sensitivas.find(item => item.regiao === regiaoSelecionada);
            if (!itemSelecionado) return;

            const nervo = itemSelecionado.nervo_periferico;
            const raizes = itemSelecionado.raizes_nervosas;

            // Sugestões: outras regiões do mesmo nervo (para confirmar periférico)
            let outrasRegioesNervo = mapaNervoRegioes[nervo].filter(r => r !== regiaoSelecionada).slice(0, 3);

            // Armazenar dados atuais para diagnóstico dinâmico
            window.nervoAtual = nervo;
            window.raizesAtuais = raizes;
            window.regiaoSelecionadaAtual = regiaoSelecionada;
            window.sintomaAtual = sintoma;

            // Exibir sugestões com checkboxes para marcar se afetado
            let html = `
                <div class="sugestao">
                    <h3>Sugestões de Testes para ${sintoma.toUpperCase()} (${regiaoSelecionada})</h3>
                     <p><strong>Nervo suspeito:</strong> ${nervo}</p>
                     <p><strong>Raízes suspeitas:</strong> <span id="raizes-suspeitas" class="suspeita">${raizes.join(', ')}</span></p>
                     <p>Marque as regiões abaixo se apresentarem o mesmo sintoma (${sintoma}). Clique em "Diagnosticar" após testar.</p>

                     <div id="nervo-section" class="categoria">Outras regiões do mesmo nervo (${nervo}) - Se afetadas, sugere lesão periférica exclusiva.</div>
                     ${outrasRegioesNervo.map(reg => `
                         <div class="regiao-item checkbox-group">
                             <input type="checkbox" id="nervo_${reg.replace(/\s+/g, '_')}" value="${reg}">
                             <label for="nervo_${reg.replace(/\s+/g, '_')}">${reg}</label>
                         </div>
                     `).join('')}

                     ${raizes.map(raiz => {
                         const regioesRaiz = mapaRaizRegioes[raiz].filter(r => r !== regiaoSelecionada).slice(0, 3);
                         if (regioesRaiz.length === 0) return '';
                         return `<div id="raiz-${raiz}-section" class="categoria">Raiz ${raiz} - Se regiões afetadas, sugere lesão nesta raiz.</div>
                         ${regioesRaiz.map(reg => `
                             <div class="regiao-item checkbox-group">
                                 <input type="checkbox" id="raiz_${raiz}_${reg.replace(/\s+/g, '_')}" value="${reg}" data-raiz="${raiz}">
                                 <label for="raiz_${raiz}_${reg.replace(/\s+/g, '_')}">${reg}</label>
                             </div>
                         `).join('')}`;
                     }).join('')}
                 </div>
            `;

             document.getElementById('sugestoes').innerHTML = html;
             document.getElementById('diagnostico').innerHTML = '';

             // Adicionar listeners para diagnóstico dinâmico
             document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                 cb.addEventListener('change', atualizarDiagnostico);
             });

             // Diagnóstico inicial
             atualizarDiagnostico();
        }

         function atualizarDiagnostico() {
            const nervo = window.nervoAtual;
            const raizes = window.raizesAtuais;
            const sintoma = window.sintomaAtual;



            // Contar afetadas por nervo
            const checkboxesNervo = document.querySelectorAll('input[id^="nervo_"]:checked');
            const afetadasNervo = checkboxesNervo.length;
            const totalNervo = document.querySelectorAll('input[id^="nervo_"]').length;

            // Contar afetadas por raiz
            const checkboxesRaiz = document.querySelectorAll('input[id^="raiz_"]:checked');
            const afetadasRaiz = checkboxesRaiz.length;
            const totalRaiz = document.querySelectorAll('input[id^="raiz_"]').length;

            // Encontrar raiz suspeita específica
            let rootAffected = {};
            checkboxesRaiz.forEach(cb => {
                const raiz = cb.getAttribute('data-raiz');
                if (!rootAffected[raiz]) rootAffected[raiz] = 0;
                rootAffected[raiz]++;
            });

            let suspectedRoot = null;
            let maxRatio = 0;
            raizes.forEach(raiz => {
                const regioesRaiz = mapaRaizRegioes[raiz].filter(r => r !== window.regiaoSelecionadaAtual);
                const total = regioesRaiz.slice(0, 3).length;
                const affected = rootAffected[raiz] || 0;
                const ratio = total > 0 ? affected / total : 0;
                if (ratio > 0.5 && ratio > maxRatio) {
                    maxRatio = ratio;
                    suspectedRoot = raiz;
                }
            });

            let diagnostico = '';
            let classe = 'indeterminado';



            if (afetadasNervo > 0 && afetadasNervo / totalNervo > 0.5) {
                // Maioria das regiões do nervo afetadas: periférico
                diagnostico = `Sugestão: Lesão exclusiva no nervo periférico (${nervo}). Todas as regiões testadas do nervo mostram ${sintoma}.`;
                classe = 'periferico';
            } else if (suspectedRoot) {
                // Raiz específica identificada
                diagnostico = `Sugestão: Lesão exclusiva na raiz nervosa ${suspectedRoot}. Regiões desta raiz mostram ${sintoma}, mas não do nervo isolado.`;
                classe = 'raiz';
            } else if (afetadasRaiz > 0) {
                diagnostico = `Indeterminado: Regiões de raízes afetadas, mas sem raiz específica clara. Teste mais regiões.`;
            } else if (afetadasNervo === 0 && afetadasRaiz === 0) {
                diagnostico = `Indeterminado: Nenhuma região adicional afetada. Teste mais regiões ou considere outros fatores.`;
            } else {
                diagnostico = `Indeterminado: Padrão misto. Teste mais regiões para esclarecer.`;
            }



            document.getElementById('diagnostico').innerHTML = `
                <div class="${classe}">${diagnostico}</div>
            `;

            // Atualizar highlights das raízes suspeitas
            const raizesSpan = document.getElementById('raizes-suspeitas');
            if (raizesSpan) {
                if (classe === 'periferico') {
                    raizesSpan.classList.remove('suspeita');
                } else if (suspectedRoot) {
                    // Destacar apenas a raiz suspeita
                    raizesSpan.innerHTML = raizes.map(r => r === suspectedRoot ? `<span class="suspeita">${r}</span>` : r).join(', ');
                } else {
                    raizesSpan.classList.add('suspeita');
                }
            }

            // Ajustar visibilidade de seções e itens
            const nervoEl = document.getElementById('nervo-section');
            if (nervoEl) {
                if (classe === 'periferico') {
                    nervoEl.style.display = 'block';
                } else if (suspectedRoot) {
                    nervoEl.style.display = 'none';
                } else {
                    nervoEl.style.display = 'block';
                }
            }

            raizes.forEach(raiz => {
                const raizEl = document.getElementById(`raiz-${raiz}-section`);
                if (raizEl) {
                    if (classe === 'periferico') {
                        raizEl.style.display = 'none';
                    } else if (suspectedRoot) {
                        raizEl.style.display = raiz === suspectedRoot ? 'block' : 'none';
                    } else {
                        raizEl.style.display = 'block';
                    }
                }
            });

            // Ocultar apenas itens desmarcados se diagnóstico estabelecido
            document.querySelectorAll('.regiao-item').forEach(item => {
                const cb = item.querySelector('input[type="checkbox"]');
                if (cb) {
                    item.style.display = (classe === 'indeterminado' || cb.checked) ? 'block' : 'none';
                }
            });
        }

        // Inicializar ao carregar
        window.onload = function() {
            inicializarDropdowns();
            criarMapas();
        };
    </script>
</body>
</html>
